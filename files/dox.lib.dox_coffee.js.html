<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CroJSDoc - dox/lib/dox_coffee.js</title><script>if (location.protocol.match(/^http/) && location.pathname.match('\.html') === null && location.pathname.slice(-1) !== '/') {
  location.href = location.href + '/';
}</script><link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="../google-code-prettify/prettify.css" rel="stylesheet" type="text/css"><link href="../style.css" rel="stylesheet" type="text/css"></head><body data-spy="scroll" data-target=".sidebar"><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><div class="container-fluid"><ul class="nav"><li><a href="../index.html">Home</a></li><li class="dropdown"><a data-toggle="dropdown" href="#" class="dropdown-toggle">Guides <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../guides/AllCommands.html">AllCommands</a></li><li><a href="../guides/SpecifyingTypes.html">SpecifyingTypes</a></li></ul></li><li><a href="../modules/generate_doc.html">Modules</a></li><li><a href="../classes/CodeContext.html">Classes</a></li><li class="dropdown active"><a data-toggle="dropdown" href="#" class="dropdown-toggle">Files - dox/lib/dox_coffee.js <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../files/comment.coffee.html">comment.coffee</a></li><li><a href="../files/example.coffee.html">example.coffee</a></li><li><a href="../files/example.js.html">example.js</a></li><li><a href="../files/generate_doc.coffee.html">generate_doc.coffee</a></li><li><a href="../files/bootstrap.js.bootstrap.js.html">bootstrap/js/bootstrap.js</a></li><li><a href="../files/bootstrap.js.bootstrap.min.js.html">bootstrap/js/bootstrap.min.js</a></li><li><a href="../files/dox.index.js.html">dox/index.js</a></li><li><a href="../files/dox.lib.api.js.html">dox/lib/api.js</a></li><li><a href="../files/dox.lib.dox.js.html">dox/lib/dox.js</a></li><li><a href="../files/dox.lib.dox_coffee.js.html">dox/lib/dox_coffee.js</a></li><li><a href="../files/dox.lib.utils.js.html">dox/lib/utils.js</a></li><li><a href="../files/google-code-prettify.lang-apollo.js.html">google-code-prettify/lang-apollo.js</a></li><li><a href="../files/google-code-prettify.lang-clj.js.html">google-code-prettify/lang-clj.js</a></li><li><a href="../files/google-code-prettify.lang-css.js.html">google-code-prettify/lang-css.js</a></li><li><a href="../files/google-code-prettify.lang-go.js.html">google-code-prettify/lang-go.js</a></li><li><a href="../files/google-code-prettify.lang-hs.js.html">google-code-prettify/lang-hs.js</a></li><li><a href="../files/google-code-prettify.lang-lisp.js.html">google-code-prettify/lang-lisp.js</a></li><li><a href="../files/google-code-prettify.lang-lua.js.html">google-code-prettify/lang-lua.js</a></li><li><a href="../files/google-code-prettify.lang-ml.js.html">google-code-prettify/lang-ml.js</a></li><li><a href="../files/google-code-prettify.lang-n.js.html">google-code-prettify/lang-n.js</a></li><li><a href="../files/google-code-prettify.lang-proto.js.html">google-code-prettify/lang-proto.js</a></li><li><a href="../files/google-code-prettify.lang-scala.js.html">google-code-prettify/lang-scala.js</a></li><li><a href="../files/google-code-prettify.lang-sql.js.html">google-code-prettify/lang-sql.js</a></li><li><a href="../files/google-code-prettify.lang-tex.js.html">google-code-prettify/lang-tex.js</a></li><li><a href="../files/google-code-prettify.lang-vb.js.html">google-code-prettify/lang-vb.js</a></li><li><a href="../files/google-code-prettify.lang-vhdl.js.html">google-code-prettify/lang-vhdl.js</a></li><li><a href="../files/google-code-prettify.lang-wiki.js.html">google-code-prettify/lang-wiki.js</a></li><li><a href="../files/google-code-prettify.lang-xq.js.html">google-code-prettify/lang-xq.js</a></li><li><a href="../files/google-code-prettify.lang-yaml.js.html">google-code-prettify/lang-yaml.js</a></li><li><a href="../files/google-code-prettify.prettify.js.html">google-code-prettify/prettify.js</a></li><li><a href="../files/tocify.jquery.tocify.min.js.html">tocify/jquery.tocify.min.js</a></li></ul></li></ul><div class="options"><label class="checkbox"><input id="options-private" type="checkbox"> Private </label></div></div></div></div><div class="container-fluid content"><div class="row-fluid"><div class="span3 visible-desktop"><div data-spy="affix" class="span3 sidebar"><ul class="nav nav-list cormo-sidenav"><li><a href="../files/comment.coffee.html">comment.coffee</a></li><li><a href="../files/example.coffee.html">example.coffee</a></li><li><a href="../files/example.js.html">example.js</a></li><li><a href="../files/generate_doc.coffee.html">generate_doc.coffee</a></li><li class="nav-header">bootstrap/js</li><li><a href="../files/bootstrap.js.bootstrap.js.html">bootstrap.js</a></li><li><a href="../files/bootstrap.js.bootstrap.min.js.html">bootstrap.min.js</a></li><li class="nav-header">dox</li><li><a href="../files/dox.index.js.html">index.js</a></li><li class="nav-header">dox/lib</li><li><a href="../files/dox.lib.api.js.html">api.js</a></li><li><a href="../files/dox.lib.dox.js.html">dox.js</a></li><li class="active"><a href="../files/dox.lib.dox_coffee.js.html">dox_coffee.js</a></li><li><a href="../files/dox.lib.utils.js.html">utils.js</a></li><li class="nav-header">google-code-prettify</li><li><a href="../files/google-code-prettify.lang-apollo.js.html">lang-apollo.js</a></li><li><a href="../files/google-code-prettify.lang-clj.js.html">lang-clj.js</a></li><li><a href="../files/google-code-prettify.lang-css.js.html">lang-css.js</a></li><li><a href="../files/google-code-prettify.lang-go.js.html">lang-go.js</a></li><li><a href="../files/google-code-prettify.lang-hs.js.html">lang-hs.js</a></li><li><a href="../files/google-code-prettify.lang-lisp.js.html">lang-lisp.js</a></li><li><a href="../files/google-code-prettify.lang-lua.js.html">lang-lua.js</a></li><li><a href="../files/google-code-prettify.lang-ml.js.html">lang-ml.js</a></li><li><a href="../files/google-code-prettify.lang-n.js.html">lang-n.js</a></li><li><a href="../files/google-code-prettify.lang-proto.js.html">lang-proto.js</a></li><li><a href="../files/google-code-prettify.lang-scala.js.html">lang-scala.js</a></li><li><a href="../files/google-code-prettify.lang-sql.js.html">lang-sql.js</a></li><li><a href="../files/google-code-prettify.lang-tex.js.html">lang-tex.js</a></li><li><a href="../files/google-code-prettify.lang-vb.js.html">lang-vb.js</a></li><li><a href="../files/google-code-prettify.lang-vhdl.js.html">lang-vhdl.js</a></li><li><a href="../files/google-code-prettify.lang-wiki.js.html">lang-wiki.js</a></li><li><a href="../files/google-code-prettify.lang-xq.js.html">lang-xq.js</a></li><li><a href="../files/google-code-prettify.lang-yaml.js.html">lang-yaml.js</a></li><li><a href="../files/google-code-prettify.prettify.js.html">prettify.js</a></li><li class="nav-header">tocify</li><li><a href="../files/tocify.jquery.tocify.min.js.html">jquery.tocify.min.js</a></li></ul></div></div><div class="span9"><section><h1>dox/lib/dox_coffee.js</h1></section><pre class="prettyprint">/*!
 * Module dependencies.
 */

var dox = require('./dox');

/**
 * Parse comments in the given string of `coffee`.
 *
 * @param {String} coffee
 * @param {Object} options
 * @return {Array}
 * @see exports.parseComment
 * @api public
 */

exports.parseCommentsCoffee = function(coffee, options){
  options = options || {};
  coffee = coffee.replace(/\r\n/gm, '\n');

  var comments = []
    , i
    , j
    , raw = options.raw
    , comment
    , buf = ''
    , ignore
    , indent
    , line_number = 1
    , buf_line_number;

  var getCodeContext = function () {
    var lines = buf.split('\n')
      , indent
      , indentre
      , i
      , len
      , code;
    // skip start empty lines
    while (lines.length&gt;0 &amp;&amp; lines[0].trim()==='') {
      lines.splice(0, 1);
      buf_line_number++;
    }
    if (lines.length!==0) {
      // get expected indent
      indent = lines[0].match(/^(\s*)/)[1];
      // remove 'indent' from beginning for each line
      indentre = new RegExp('^' + indent);
      for (i = 0, len = lines.length; i &lt; len; i++) {
        // skip empty line
        if (lines[i].trim()==='') {
          continue;
        }
        lines[i] = lines[i].replace(indentre, '');
        // find line of same or little indent to stop there
        if (i!==0 &amp;&amp; !lines[i].match(/^\s/)) {
          break;
        }
      }
      // cut below lines
      lines.length = i;
    }
    code = lines.join('\n').trim();
    // add code to previous comment
    comment = comments[comments.length - 1];
    if (comment) {
      indent = comment.indent;
      // find parent
      for (i = comments.length - 2; i&gt;=0 ; i--) {
        if (comments[i].indent.search(indent)&lt;0) {
          break;
        }
      }
      comment.code = code;
      comment.line_number = buf_line_number;
      comment.ctx = exports.parseCodeContextCoffee(code, i&gt;=0 ? comments[i] : null);
    }
    buf = '';
  };

  var addBuf = function () {
    buf += coffee[i];
    if ('\n' == coffee[i]) {
      line_number++;
      return true;
    }
    return false;
  };

  var addBufLine = function () {
    for (; i &lt; len; i++) {
      if (addBuf(i)) {
        break;
      }
    }
  };

  var addComment = function () {
    comment = dox.parseComment(buf, options);
    comment.ignore = ignore;
    comment.indent = indent;
    comments.push(comment);
    buf = '';
    buf_line_number = line_number;
  }

  for (i = 0, len = coffee.length; i &lt; len; ++i) {
    // block comment
    if (coffee.slice(i, i+3) == '###') {
      indent = buf.match(/([ \t]*)$/)[1];
      // code following previous comment
      getCodeContext();
      i += 3;
      if ('\n' == coffee[i]) line_number++;
      ignore = '!' == coffee[i];
      i++;
      for (; i &lt; len; i++) {
        if (coffee.slice(i, i+3) == '###') {
          i += 3;
          if ('\n' == coffee[i]) line_number++;
          buf = buf.replace(/^ *[\*\#] ?/gm, '');
          addComment();
          break;
        }
        addBuf(i);
      }
    // doxygen style comment
    } else if ('#' == coffee[i] &amp;&amp; '#' == coffee[i+1]) {
      indent = buf.match(/([ \t]*)$/)[1];
      // code following previous comment
      getCodeContext();
      i += 2;
      ignore = '!' == coffee[i];
      if ('\n' == coffee[i]) {
        line_number++;
      } else {
        i++;
        addBufLine();
      }
      while (1) {
        i++;
        // check whether line comment
        for (var j=i; j &lt; len; j++) {
          if ('#' == coffee[j]) {
            break;
          }
          if (' ' != coffee[j] &amp;&amp; '\t' != coffee[j]) {
            break;
          }
        }
        if ('#' != coffee[j]) {
          buf = buf.replace(/^ *#{1,2} {0,2}/gm, '');
          addComment();
          i--;
          break;
        }
        // add this line if comment
        addBufLine();
      }
    // line comment
    } else if ('#' == coffee[i]) {
      addBufLine();
    // buffer code
    } else {
      addBuf(i);
    }
  }

  if (comments.length === 0) {
    comments.push({
      tags: [],
      description: {full: '', summary: '', body: ''},
      isPrivate: false
    });
  }

  // trailing code
  getCodeContext();

  return comments;
};

/**
 * Parse the context from the given `str` of coffee.
 *
 * This method attempts to discover the context
 * for the comment based on it's code. Currently
 * supports:
 *
 *   - function statements
 *   - function expressions
 *   - prototype methods
 *   - prototype properties
 *   - methods
 *   - properties
 *   - declarations
 *
 * @param {String} str
 * @return {Object}
 * @api public
 */

exports.parseCodeContextCoffee = function(str, parent) {
  var str = str.split('\n')[0]
    , class_name;

  // function expression
  if (/^(\w+) *= *(\(.*\)|) *[-=]&gt;/.exec(str)) {
    return {
        type: 'function'
      , name: RegExp.$1
      , string: RegExp.$1 + '()'
    };
  // prototype method
  } else if (/^(\w+)::(\w+) *= *(\(.*\)|) *[-=]&gt;/.exec(str)) {
    return {
        type: 'method'
      , constructor: RegExp.$1
      , cons: RegExp.$1
      , name: RegExp.$2
      , string: RegExp.$1 + '::' + RegExp.$2 + '()'
    };
  // prototype property
  } else if (/^(\w+)::(\w+) *= *([^\n]+)/.exec(str)) {
    return {
        type: 'property'
      , constructor: RegExp.$1
      , cons: RegExp.$1
      , name: RegExp.$2
      , value: RegExp.$3
      , string: RegExp.$1 + '::' + RegExp.$2
    };
  // method
  } else if (/^[\w.]*?(\w+)\.(\w+) *= *(\(.*\)|) *[-=]&gt;/.exec(str)) {
    return {
        type: 'method'
      , receiver: RegExp.$1
      , name: RegExp.$2
      , string: RegExp.$1 + '.' + RegExp.$2 + '()'
    };
  // property
  } else if (/^[\w.]*?(\w+)\.(\w+) *= *([^\n]+)/.exec(str)) {
    return {
        type: 'property'
      , receiver: RegExp.$1
      , name: RegExp.$2
      , value: RegExp.$3
      , string: RegExp.$1 + '.' + RegExp.$2
    };
  // declaration
  } else if (/^(\w+) *= *([^\n]+)/.exec(str)) {
    return {
        type: 'declaration'
      , name: RegExp.$1
      , value: RegExp.$2
      , string: RegExp.$1
    };
  }

  if (parent &amp;&amp; parent.ctx &amp;&amp; parent.ctx.type==='class') {
    class_name = parent.ctx.name;
  }

  // CoffeeScript class syntax
  if (/\bclass +(\w+)/.exec(str)) {
    return {
        type: 'class'
      , name: RegExp.$1
      , string: 'class ' + RegExp.$1
    };
  } else if (!class_name) {
  // prototype method
  } else if (/^(\w+) *: *(\(.*\)|) *[-=]&gt;/.exec(str)) {
    return {
        type: 'method'
      , constructor: class_name
      , cons: class_name
      , name: RegExp.$1
      , string: class_name + '::' + RegExp.$1 + '()'
    };
  // prototype property
  } else if (/^(\w+) *: *([^\n]+)/.exec(str)) {
    return {
        type: 'property'
      , constructor: class_name
      , cons: class_name
      , name: RegExp.$1
      , value: RegExp.$2
      , string: class_name + '::' + RegExp.$1
    };
  // method
  } else if (/^@(\w+) *: *(\(.*\)|) *[-=]&gt;/.exec(str)) {
    return {
        type: 'method'
      , receiver: class_name
      , name: RegExp.$1
      , string: class_name + '.' + RegExp.$1 + '()'
    };
  // property
  } else if (/^@(\w+) *: *([^\n]+)/.exec(str)) {
    return {
        type: 'property'
      , receiver: class_name
      , name: RegExp.$1
      , value: RegExp.$2
      , string: class_name + '.' + RegExp.$1
    };
  } else {
    return {
        class_name: class_name
    };
  }
};</pre></div></div></div><script src="http://code.jquery.com/jquery-1.8.2.min.js"></script><script src="../bootstrap/js/bootstrap.min.js"></script><script src="../google-code-prettify/prettify.js"></script><script>$(function() {
  // make result of marked for pretty print
  $('pre code[class^="lang-"]').addClass('.prettyprint');
  window.prettyPrint && prettyPrint()
});
$('body').on('click', '.showcode', function () {
  $(this).parent().find('pre.sourcecode').toggle();
  $('body').scrollspy('refresh');
});
$('#options-private').on('click', function () {
  $('.private').toggle();
  $('body').scrollspy('refresh');
});</script><a href="https://github.com/croquiscom/crojsdoc"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" class="github-ribbon"></a></body></html>