<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CroJSDoc - generate_doc.coffee</title><script>if (location.protocol.match(/^http/) && location.pathname.match('\.html') === null && location.pathname.slice(-1) !== '/') {
  location.href = location.href + '/';
}</script><link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="../google-code-prettify/prettify.css" rel="stylesheet" type="text/css"><link href="../style.css" rel="stylesheet" type="text/css"></head><body data-spy="scroll" data-target=".sidebar"><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><div class="container-fluid"><ul class="nav"><li><a href="../index.html">Home</a></li><li class="dropdown"><a data-toggle="dropdown" href="#" class="dropdown-toggle">Guides <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../guides/AllCommands.html">AllCommands</a></li><li><a href="../guides/SpecifyingTypes.html">SpecifyingTypes</a></li></ul></li><li><a href="../modules/generate_doc.html">Modules</a></li><li><a href="../classes/CodeContext.html">Classes</a></li><li class="dropdown active"><a data-toggle="dropdown" href="#" class="dropdown-toggle">Files - generate_doc.coffee <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../files/comment.coffee.html">comment.coffee</a></li><li><a href="../files/example.coffee.html">example.coffee</a></li><li><a href="../files/example.js.html">example.js</a></li><li><a href="../files/generate_doc.coffee.html">generate_doc.coffee</a></li><li><a href="../files/bootstrap.js.bootstrap.js.html">bootstrap/js/bootstrap.js</a></li><li><a href="../files/bootstrap.js.bootstrap.min.js.html">bootstrap/js/bootstrap.min.js</a></li><li><a href="../files/dox.index.js.html">dox/index.js</a></li><li><a href="../files/dox.lib.api.js.html">dox/lib/api.js</a></li><li><a href="../files/dox.lib.dox.js.html">dox/lib/dox.js</a></li><li><a href="../files/dox.lib.dox_coffee.js.html">dox/lib/dox_coffee.js</a></li><li><a href="../files/dox.lib.utils.js.html">dox/lib/utils.js</a></li><li><a href="../files/google-code-prettify.lang-apollo.js.html">google-code-prettify/lang-apollo.js</a></li><li><a href="../files/google-code-prettify.lang-clj.js.html">google-code-prettify/lang-clj.js</a></li><li><a href="../files/google-code-prettify.lang-css.js.html">google-code-prettify/lang-css.js</a></li><li><a href="../files/google-code-prettify.lang-go.js.html">google-code-prettify/lang-go.js</a></li><li><a href="../files/google-code-prettify.lang-hs.js.html">google-code-prettify/lang-hs.js</a></li><li><a href="../files/google-code-prettify.lang-lisp.js.html">google-code-prettify/lang-lisp.js</a></li><li><a href="../files/google-code-prettify.lang-lua.js.html">google-code-prettify/lang-lua.js</a></li><li><a href="../files/google-code-prettify.lang-ml.js.html">google-code-prettify/lang-ml.js</a></li><li><a href="../files/google-code-prettify.lang-n.js.html">google-code-prettify/lang-n.js</a></li><li><a href="../files/google-code-prettify.lang-proto.js.html">google-code-prettify/lang-proto.js</a></li><li><a href="../files/google-code-prettify.lang-scala.js.html">google-code-prettify/lang-scala.js</a></li><li><a href="../files/google-code-prettify.lang-sql.js.html">google-code-prettify/lang-sql.js</a></li><li><a href="../files/google-code-prettify.lang-tex.js.html">google-code-prettify/lang-tex.js</a></li><li><a href="../files/google-code-prettify.lang-vb.js.html">google-code-prettify/lang-vb.js</a></li><li><a href="../files/google-code-prettify.lang-vhdl.js.html">google-code-prettify/lang-vhdl.js</a></li><li><a href="../files/google-code-prettify.lang-wiki.js.html">google-code-prettify/lang-wiki.js</a></li><li><a href="../files/google-code-prettify.lang-xq.js.html">google-code-prettify/lang-xq.js</a></li><li><a href="../files/google-code-prettify.lang-yaml.js.html">google-code-prettify/lang-yaml.js</a></li><li><a href="../files/google-code-prettify.prettify.js.html">google-code-prettify/prettify.js</a></li><li><a href="../files/tocify.jquery.tocify.min.js.html">tocify/jquery.tocify.min.js</a></li></ul></li></ul><div class="options"><label class="checkbox"><input id="options-private" type="checkbox"> Private </label></div></div></div></div><div class="container-fluid content"><div class="row-fluid"><div class="span3 visible-desktop"><div data-spy="affix" class="span3 sidebar"><ul class="nav nav-list cormo-sidenav"><li><a href="../files/comment.coffee.html">comment.coffee</a></li><li><a href="../files/example.coffee.html">example.coffee</a></li><li><a href="../files/example.js.html">example.js</a></li><li class="active"><a href="../files/generate_doc.coffee.html">generate_doc.coffee</a></li><li class="nav-header">bootstrap/js</li><li><a href="../files/bootstrap.js.bootstrap.js.html">bootstrap.js</a></li><li><a href="../files/bootstrap.js.bootstrap.min.js.html">bootstrap.min.js</a></li><li class="nav-header">dox</li><li><a href="../files/dox.index.js.html">index.js</a></li><li class="nav-header">dox/lib</li><li><a href="../files/dox.lib.api.js.html">api.js</a></li><li><a href="../files/dox.lib.dox.js.html">dox.js</a></li><li><a href="../files/dox.lib.dox_coffee.js.html">dox_coffee.js</a></li><li><a href="../files/dox.lib.utils.js.html">utils.js</a></li><li class="nav-header">google-code-prettify</li><li><a href="../files/google-code-prettify.lang-apollo.js.html">lang-apollo.js</a></li><li><a href="../files/google-code-prettify.lang-clj.js.html">lang-clj.js</a></li><li><a href="../files/google-code-prettify.lang-css.js.html">lang-css.js</a></li><li><a href="../files/google-code-prettify.lang-go.js.html">lang-go.js</a></li><li><a href="../files/google-code-prettify.lang-hs.js.html">lang-hs.js</a></li><li><a href="../files/google-code-prettify.lang-lisp.js.html">lang-lisp.js</a></li><li><a href="../files/google-code-prettify.lang-lua.js.html">lang-lua.js</a></li><li><a href="../files/google-code-prettify.lang-ml.js.html">lang-ml.js</a></li><li><a href="../files/google-code-prettify.lang-n.js.html">lang-n.js</a></li><li><a href="../files/google-code-prettify.lang-proto.js.html">lang-proto.js</a></li><li><a href="../files/google-code-prettify.lang-scala.js.html">lang-scala.js</a></li><li><a href="../files/google-code-prettify.lang-sql.js.html">lang-sql.js</a></li><li><a href="../files/google-code-prettify.lang-tex.js.html">lang-tex.js</a></li><li><a href="../files/google-code-prettify.lang-vb.js.html">lang-vb.js</a></li><li><a href="../files/google-code-prettify.lang-vhdl.js.html">lang-vhdl.js</a></li><li><a href="../files/google-code-prettify.lang-wiki.js.html">lang-wiki.js</a></li><li><a href="../files/google-code-prettify.lang-xq.js.html">lang-xq.js</a></li><li><a href="../files/google-code-prettify.lang-yaml.js.html">lang-yaml.js</a></li><li><a href="../files/google-code-prettify.prettify.js.html">prettify.js</a></li><li class="nav-header">tocify</li><li><a href="../files/tocify.jquery.tocify.min.js.html">jquery.tocify.min.js</a></li></ul></div></div><div class="span9"><section><h1>generate_doc.coffee</h1></section><pre class="prettyprint">##
# @module generate_doc

fs = require 'fs'
{basename,dirname,resolve} = require 'path'

glob = require 'glob'
jade = require 'jade'
markdown = require 'marked'
walkdir = require 'walkdir'

dox = require './dox'

##
# Links for pre-known types
# @private
# @memberOf generate_doc
# @property types
types =
  Object: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'
  Boolean: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Boolean'
  String: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'
  Array: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array'
  Number: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number'
  Date: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date'
  Function: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function'
  RegExp: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/RegExp'
  Error: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Error'
  undefined: 'https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/undefined'

makeMissingLink = (type, place = '') -&gt;
  txt = if result.ids[type]
    &quot;'#{type}' link is ambiguous&quot;
  else
    &quot;'#{type}' link does not exist&quot;
  console.log txt + &quot; #{place}&quot;
  return &quot;&lt;span class='missing-link'&gt;#{type}&lt;/span&gt;&quot;

##
# Makes links for given type
#
# * &quot;String&quot; -&amp;gt; &quot;&amp;lt;a href='reference url for String'&amp;gt;String&amp;lt;/a&amp;gt;&quot;
# * &quot;Array&amp;lt;Model&amp;gt;&quot; -&amp;gt; &quot;&amp;lt;a href='reference url for Array'&amp;gt;Array&amp;lt;/a&amp;gt;&amp;amp;lt;&amp;lt;a href='internal url for Model'&amp;gt;Model&amp;lt;/a&amp;gt;&amp;amp;gt;&quot;
# @private
# @memberOf generate_doc
# @param {String} rel_path
# @param {String} type
# @return {String}
makeTypeLink = (rel_path, type, place = '') -&gt;
  return type if not type
  getlink = (type) -&gt;
    if types[type]
      link = types[type]
    else if result.ids[type] and result.ids[type] isnt 'DUPLICATED ENTRY'
      filename = result.ids[type].filename + '.html'
      html_id = result.ids[type].html_id
      link = &quot;#{rel_path}#{filename}##{html_id}&quot;
    else
      return makeMissingLink type, place
    return &quot;&lt;a href='#{link}'&gt;#{type}&lt;/a&gt;&quot;
  if res = type.match(/\[(.*)\]\((.*)\)/)
    types[res[1]] = res[2]
    return &quot;&lt;a href='#{res[2]}'&gt;#{res[1]}&lt;/a&gt;&quot;
  if res = type.match /(.*?)&lt;(.*)&gt;/
    return &quot;#{makeTypeLink rel_path, res[1]}&amp;lt;#{makeTypeLink rel_path, res[2]}&amp;gt;&quot;
  else
    return getlink type

makeSeeLink = (rel_path, str) -&gt;
  if result.ids[str]
    filename = result.ids[str].filename + '.html'
    html_id = result.ids[str].html_id
    str = &quot;&lt;a href='#{rel_path}#{filename}##{html_id}'&gt;#{str}&lt;/a&gt;&quot;
  return str

##
# Returns list of comments of the given file
# @private
# @memberOf generate_doc
# @param {String} file
# @return {Array&lt;Comment&gt;}
getComments = (file, path) -&gt;
  return if fs.statSync(file).isDirectory()
  content = fs.readFileSync(file, 'utf-8').trim()
  return if not content

  file = file.substr(path.length+1)

  if /\.coffee$/.test file
    comments = dox.parseCommentsCoffee content, { raw: true }
    add_to_file = true
  else if /\.js$/.test file
    comments = dox.parseComments content, { raw: true }
    add_to_file = true
  else if /Page\.md$/.test file
    namespace = ''
    file = file.substr(0, file.length-3).replace(/[^A-Za-z0-9]*Page$/, '')
    file = file.replace /(.*)\//, (_, $1) -&gt;
      namespace = $1
      return ''
    comments = [ {
      description:
        summary: ''
        body: content
        full: ''
      tags: [
        { type: 'page', string: file }
        { type: 'namespace', string: namespace }
      ]
    } ]
  else if /Guide\.md$/.test file
    file = file.substr(0, file.length-8).replace(/\//g, '.')
    result.guides.push
      name: file
      filename: 'guides/' + file
      content: content
  else if /\.feature$/.test file
    file = file.substr 0, file.length-8
    namespace = ''
    file = file.replace /(.*)\//, (_, $1) -&gt;
      namespace = $1 + '/'
      return ''
    feature = ''
    content = content.replace /Feature: (.*)/, (_, $1) -&gt;
      feature = $1
      return ''
    result.features.push
      name: namespace + file
      namespace: namespace
      filename: 'features/' + namespace.replace(/\//g, '.') + file
      feature: feature
      content: content

  if add_to_file
    namespace = ''
    file = file.replace /(.*)\//, (_, $1) -&gt;
      namespace = $1 + '/'
      return ''
    result.files.push
      name: namespace + file
      namespace: namespace
      filename: 'files/' + namespace.replace(/\//g, '.') + file
      content: content

  # filter out empty comments
  return comments?.filter (comment) -&gt;
    return comment.description.full or comment.description.summary or comment.description.body or comment.tags?.length &gt; 0

##
# Parsed result
# @private
# @memberOf generate_doc
# @property result
result =
  project_title: ''
  ids: {}
  classes: {}
  guides: []
  pages: {}
  restapis: {}
  features: []
  files: []

##
# Checks flags of parameter
#
# * '[' name ']' : optional
# * name '=' value : default value
# * '+' name : addable
# * '-' name : excludable
# @private
# @memberOf generate_doc
# @param {Object} tag
# @return {Object} given tag
processParamFlags = (tag) -&gt;
  # is optional parameter?
  if /\[([^\[\]]+)\]/.exec tag.name
    tag.name = RegExp.$1
    tag.optional = true
  if tag.name.substr(0, 1) is '+'
    tag.name = tag.name.substr(1)
    tag.addable = true
  if tag.name.substr(0, 1) is '-'
    tag.name = tag.name.substr(1)
    tag.excludable = true
  return tag

##
# Finds a parameter in the list
# @private
# @memberOf generate_doc
# @param {Array&lt;Object&gt;} params
# @param {String} name
# @return {Object}
findParam = (params, name) -&gt;
  for param in params
    if param.name is name
      return param
    if param.params
      found = findParam param.params, name
      return found if found
  return

##
# Makes parameters(or returnprops) nested
# @private
# @memberOf generate_doc
makeNested = (comment, targetName) -&gt;
  i = comment[targetName].length
  while i--&gt;0
    param = comment[targetName][i]
    if match = param.name.match /\[?([^=]*)\.([^\]]*)\]?/
      parentParam = findParam comment[targetName], match[1]
      if parentParam
        comment[targetName].splice i, 1
        parentParam[targetName] = parentParam[targetName] or []
        param.name = match[2]
        parentParam[targetName].unshift param

##
# Converts link markups to HTML links in the description
# @private
# @memberOf generate_doc
convertLink = (rel_path, str) -&gt;
  return '' if not str
  str = str.replace /\[\[#([^\[\]]+)\]\]/g, (_, $1) -&gt;
    if result.ids[$1] and result.ids[$1] isnt 'DUPLICATED ENTRY'
      filename = result.ids[$1].filename + '.html'
      html_id = result.ids[$1].html_id
      return &quot;&lt;a href='#{rel_path}#{filename}##{html_id}'&gt;#{$1}&lt;/a&gt;&quot;
    else
      return makeMissingLink $1
  return str

##
# Apply markdown
# @private
# @memberOf generate_doc
applyMarkdown = (str) -&gt;
  # we cannot use '###' for header level 3 or above in CoffeeScript, instead web use '##\#', ''##\##', ...
  # recover this for markdown
  str = str.replace /#\\#/g, '##'
  return markdown str

##
# Classifies type and collect id
# @private
# @memberOf generate_doc
classifyComments = (file, comments) -&gt;
  current_class = undefined
  current_module = undefined

  comments.forEach (comment) -&gt;
    comment.defined_in = file
    comment.ctx or comment.ctx = {}
    comment.params = []
    comment.returnprops = []
    comment.throws = []
    comment.resterrors = []
    comment.sees = []
    comment.todos = []
    comment.extends = []
    comment.subclasses = []
    comment.uses = []
    comment.usedbys = []
    comment.properties = []
    comment.examples = []

    if comment.ctx.type is 'property' or comment.ctx.type is 'method'
      id = comment.ctx.string.replace('()', '')
    else
      id = comment.ctx.name
    comment.ctx.fullname = id
    comment.namespace = ''

    if comment.ctx.type is 'property' or comment.ctx.type is 'method'
      if comment.ctx.cons?
        comment.static = false
        comment.ctx.class_name = comment.ctx.cons
      else if comment.ctx.receiver?
        comment.static = true
        comment.ctx.class_name = comment.ctx.receiver

    last = 0
    for tag, i in comment.tags
      if tag.type is ''
        comment.tags[last].string += &quot;\n#{tag.string}&quot;
        continue
      last = i
      switch tag.type
        when 'page', 'restapi', 'class'
          comment.ctx.type = tag.type
          if tag.string
            comment.ctx.name = tag.string
            comment.ctx.fullname = id = comment.ctx.name
        when 'module'
          comment.ctx.type = 'class'
          comment.is_module = true
          if tag.string
            comment.ctx.name = tag.string
            comment.ctx.fullname = id = comment.ctx.name
          comment.code = null
        when 'memberOf'
          if /(::|#|prototype)$/.test tag.parent
            comment.static = false
            comment.ctx.class_name = tag.parent.replace /(::|#|prototype)$/, ''
          else
            comment.static = true
            comment.ctx.class_name = tag.parent
        when 'namespace'
          comment.namespace = if tag.string then tag.string + '.' else ''
        when 'property', 'method'
          comment.ctx.type = tag.type
          comment.ctx.name = tag.string
        when 'static'
          comment.static = true
        when 'private'
          comment.isPrivate = true
        when 'abstract'
          comment.abstract = true
        when 'async'
          comment.async = true
        when 'param', 'return', 'returnprop', 'throws', 'resterror', 'see'
          , 'extends', 'todo', 'type', 'api', 'uses', 'override'
        else
          console.log &quot;Unknown tag : #{tag.type} in #{file}&quot;

    if comment.ctx.class_name
      if comment.ctx.type is 'function'
        comment.ctx.type = 'method'
      else if comment.ctx.type is 'declaration'
        comment.ctx.type = 'property'
      seperator = if comment.static then '.' else '::'
      id = comment.ctx.class_name + seperator + comment.ctx.name
      comment.ctx.fullname = comment.ctx.class_name.replace(/.*[\./](\w+)/, '$1') + seperator + comment.ctx.name

    if comment.ctx.type is 'class'
      current_class = comment
      if comment.is_module
        current_module = comment

    if (comment.ctx.type is 'property' or comment.ctx.type is 'method') and not comment.namespace
      if current_class
        comment.namespace = current_class.namespace
      if current_module and not comment.ctx.class_name
        comment.ctx.class_name = current_module.ctx.name

    if id
      if result.ids.hasOwnProperty id
        result.ids[id] = 'DUPLICATED ENTRY'
      else
        result.ids[id] = comment
        result.ids[comment.namespace+id] = comment
      comment.html_id = (comment.namespace+id).replace(/[^A-Za-z0-9_]/g, '_')

    switch comment.ctx.type
      when 'class'
        comment.ctx.name = comment.namespace + comment.ctx.name
        comment.ctx.fullname = comment.namespace + comment.ctx.fullname
        result.classes[comment.ctx.name] = comment
        if comment.is_module
          comment.filename = 'modules/' + comment.ctx.name.replace(/\//g, '.')
        else
          comment.filename = 'classes/' + comment.ctx.name.replace(/\//g, '.')
      when 'property', 'method'
        comment.ctx.class_name = comment.namespace + comment.ctx.class_name
        comment.filename = 'classes/' + comment.ctx.class_name.replace(/\//g, '.')
      when 'page'
        comment.filename = 'pages'
      when 'restapi'
        comment.filename = 'restapis'

##
# Structuralizes comments
# @private
# @memberOf generate_doc
processComments = (comments) -&gt;
  comments.forEach (comment) -&gt;
    desc = comment.description
    if desc
      desc.full = applyMarkdown desc.full
      desc.summary = applyMarkdown desc.summary
      desc.body = applyMarkdown desc.body

    for tag in comment.tags
      switch tag.type
        when 'param'
          tag = processParamFlags tag
          for type, i in tag.types
            tag.types[i] = type
          tag.description = tag.description
          comment.params.push tag
        when 'return'
          for type, i in tag.types
            tag.types[i] = type
          tag.description = tag.description
          comment.return = tag
        when 'returnprop'
          tag = dox.parseTag '@param ' + tag.string
          tag = processParamFlags tag
          for type, i in tag.types
            tag.types[i] = type
          tag.description = tag.description
          comment.returnprops.push tag
        when 'throws'
          if /{([^}]+)}\s*(.*)/.exec tag.string
            comment.throws.push message: RegExp.$1, description: RegExp.$2
          else
            comment.throws.push message: tag.string, description: ''
        when 'resterror'
          if /{(\d+)\/([A-Za-z0-9_ ]+)}\s*(.*)/.exec tag.string
            comment.resterrors.push code: RegExp.$1, message: RegExp.$2, description: RegExp.$3
        when 'see'
          str = tag.local or tag.url
          comment.sees.push str
        when 'todo'
          comment.todos.push tag.string
        when 'extends'
          comment.extends.push tag.string
          result.ids[tag.string]?.subclasses.push comment.ctx.name
        when 'uses'
          comment.uses.push tag.string
          result.ids[tag.string]?.usedbys.push comment.ctx.name
        when 'type'
          for type, i in tag.types
            tag.types[i] = type
          comment.types = tag.types
        when 'example'
          comment.examples.push tag
        when 'override'
          if result.ids[tag.string] and result.ids[tag.string] isnt 'DUPLICATED ENTRY'
            comment.override = result.ids[tag.string]
          comment.override_link = tag.string

    if comment.ctx.type is 'class'
      if /^class +\w+ +extends +([\w\.]+)/.exec comment.code
        comment.extends.push RegExp.$1
        result.ids[RegExp.$1]?.subclasses.push comment.ctx.name

    # make parameters nested
    makeNested comment, 'params'
    makeNested comment, 'returnprops'

    switch comment.ctx.type
      when 'property', 'method'
        class_name = comment.ctx.class_name
        if class_name and class_comment = result.classes[class_name]
          class_comment.properties.push comment
          if class_comment.is_module
            comment.filename = comment.filename.replace('classes/', 'modules/')
      when 'page'
        result.pages[comment.ctx.name] = comment
      when 'restapi'
        result.restapis[comment.ctx.name] = comment

##
# Refines result.
#
# - convert hash to sorted array
# - classes -&gt; classes &amp; modules
refineResult = (result) -&gt;
  result.classes = Object.keys(result.classes).sort( (a,b) -&gt;
    a_ns = result.classes[a].namespace
    b_ns = result.classes[b].namespace
    return -1 if a_ns &lt; b_ns
    return 1 if a_ns &gt; b_ns
    if a&lt;b then -1 else 1
  ).map (name) -&gt; result.classes[name]
  result.pages = Object.keys(result.pages).sort( (a,b) -&gt;
    a_ns = result.pages[a].namespace
    b_ns = result.pages[b].namespace
    return -1 if a_ns &lt; b_ns
    return 1 if a_ns &gt; b_ns
    if a&lt;b then -1 else 1
  ).map (name) -&gt; result.pages[name]
  result.restapis = Object.keys(result.restapis).sort( (a,b) -&gt;
    a_ns = result.restapis[a].namespace
    b_ns = result.restapis[b].namespace
    return -1 if a_ns &lt; b_ns
    return 1 if a_ns &gt; b_ns
    a = a.replace /([A-Z]+) \/(.*)/, '-$2 $1'
    b = b.replace /([A-Z]+) \/(.*)/, '-$2 $1'
    if a&lt;b then -1 else 1
  ).map (name) -&gt; result.restapis[name]
  result.guides = result.guides.sort (a,b) -&gt;
    if a.name&lt;b.name then -1 else 1
  result.features = result.features.sort (a,b) -&gt;
    if a.name&lt;b.name then -1 else 1
  result.files = result.files.sort (a,b) -&gt;
    a_ns = a.namespace
    b_ns = b.namespace
    return -1 if a_ns &lt; b_ns
    return 1 if a_ns &gt; b_ns
    if a.name&lt;b.name then -1 else 1

  result.modules = result.classes.filter (klass) -&gt; klass.is_module
  result.classes = result.classes.filter (klass) -&gt; not klass.is_module

copyResources = (source, target, callback) -&gt;
  exec = require('child_process').exec
  exec &quot;rm -rf #{target}/* ; mkdir -p #{target} ; cp -a #{source}/bootstrap #{source}/google-code-prettify #{source}/tocify #{source}/style.css #{target}&quot;, -&gt;
    callback()

render = (result, genopts, options, template, output) -&gt;
  options.result = result
  options.makeTypeLink = makeTypeLink if not options.makeTypeLink
  options.makeSeeLink = makeSeeLink
  options.convertLink = convertLink
  options.genopts = genopts
  options.cache = true
  jade.renderFile &quot;#{genopts.template_dir}/#{template}.jade&quot;, options, (error, result) -&gt;
    return console.error error.stack if error
    output_file = &quot;#{genopts.doc_dir}/#{output}.html&quot;
    fs.writeFile output_file, result, (error) -&gt;
      return console.error 'failed to create '+output_file if error
      console.log output_file + ' is created' if not genopts.quite

renderReadme = (result, genopts) -&gt;
  fs.readFile &quot;#{genopts.readme || genopts.project_dir}/README.md&quot;, 'utf-8', (error, content) -&gt;
    if content
      content = applyMarkdown content
    options =
      rel_path: './'
      name: 'README'
      content: content
      type: 'home'
    render result, genopts, options, 'extra', 'index'

renderGuides = (result, genopts) -&gt;
  return if result.guides.length is 0
  try fs.mkdirSync &quot;#{genopts.doc_dir}/guides&quot;
  result.guides.forEach (guide) -&gt;
    content = guide.content
    if content
      content = applyMarkdown content
    options =
      rel_path: '../'
      name: guide.name
      content: content
      type: 'guides'
    render result, genopts, options, 'extra', guide.filename

renderPages = (result, genopts) -&gt;
  if result.pages.length &gt; 0
    options =
      rel_path: './'
      name: 'Pages'
      type: 'pages'
    render result, genopts, options, 'pages', 'pages'

renderRESTApis = (result, genopts) -&gt;
  if result.restapis.length &gt; 0
    options =
      rel_path: './'
      name: 'REST APIs'
      type: 'restapis'
    render result, genopts, options, 'restapis', 'restapis'

renderClasses = (result, genopts) -&gt;
  return if result.classes.length is 0
  try fs.mkdirSync &quot;#{genopts.doc_dir}/classes&quot;
  result.classes.forEach (klass) -&gt;
    properties = klass.properties.sort (a, b) -&gt; if a.ctx.name &lt; b.ctx.name then -1 else 1
    options =
      rel_path: '../'
      name: klass.ctx.name
      klass: klass
      properties: properties
      type: 'classes'
      makeTypeLink: (path, type) -&gt;
        makeTypeLink path, type, &quot;(in #{klass.defined_in})&quot;
    render result, genopts, options, 'class', klass.filename

renderModules = (result, genopts) -&gt;
  return if result.modules.length is 0
  try fs.mkdirSync &quot;#{genopts.doc_dir}/modules&quot;
  result.modules.forEach (module) -&gt;
    properties = module.properties.sort (a, b) -&gt; if a.ctx.name &lt; b.ctx.name then -1 else 1
    options =
      rel_path: '../'
      name: module.ctx.name
      module_data: module
      properties: properties
      type: 'modules'
    render result, genopts, options, 'module', module.filename

renderFeatures = (result, genopts) -&gt;
  return if result.features.length is 0
  try fs.mkdirSync &quot;#{genopts.doc_dir}/features&quot;
  result.features.forEach (feature) -&gt;
    options =
      rel_path: '../'
      name: feature.name
      feature: feature
      type: 'features'
    render result, genopts, options, 'feature', feature.filename

renderFiles = (result, genopts) -&gt;
  return if result.files.length is 0
  try fs.mkdirSync &quot;#{genopts.doc_dir}/files&quot;
  result.files.forEach (file) -&gt;
    options =
      rel_path: '../'
      name: file.name
      file: file
      type: 'files'
    render result, genopts, options, 'file', file.filename

##
# Generates documents
# @memberOf generate_doc
generate = (paths, genopts) -&gt;
  result.project_title = genopts?.title or 'croquis-jsdoc'

  if external_types = genopts?['external-types']
    if typeof external_types is 'string'
      try
        content = fs.readFileSync(external_types, 'utf-8').trim()
        try
          external_types = JSON.parse content
        catch e
          console.log &quot;external-types: Invalid JSON file&quot;
      catch e
        console.log &quot;external-types: Cannot open #{genopts['external-types']}&quot;
    if typeof external_types is 'object'
      for type, url of external_types
        types[type] = url

  genopts.project_dir = process.cwd()
  output_dir = genopts?.output or 'doc'
  if output_dir[0] is '/'
    genopts.doc_dir = output_dir
  else
    genopts.doc_dir = genopts.project_dir + '/' + output_dir
  genopts.template_dir = __dirname + '/templates'

  file_count_read = 0

  all_comments = []
  paths.forEach (path) -&gt;
    base_path = path = resolve genopts.project_dir, path
    base_path = dirname base_path while /[*?]/.test basename(base_path)
    glob.sync(path).forEach (path) -&gt;
      if fs.statSync(path).isDirectory()
        list = walkdir.sync path
      else
        list = [path]
      list.forEach (file) -&gt;
        comments = getComments file, base_path
        return if not comments?

        file_count_read++
        console.log file + ' is processed' if not genopts.quite

        file = file.replace new RegExp(&quot;^&quot; + genopts.project_dir), ''
        classifyComments file, comments
        all_comments.push.apply all_comments, comments

  console.log 'Total ' + file_count_read + ' files processed'

  processComments all_comments

  if not genopts.files
    result.files = []
  refineResult result

  copyResources __dirname, genopts.doc_dir, -&gt;
    renderReadme result, genopts
    renderGuides result, genopts
    renderPages result, genopts
    renderRESTApis result, genopts
    renderClasses result, genopts
    renderModules result, genopts
    renderFeatures result, genopts
    renderFiles result, genopts

module.exports = generate</pre></div></div></div><script src="http://code.jquery.com/jquery-1.8.2.min.js"></script><script src="../bootstrap/js/bootstrap.min.js"></script><script src="../google-code-prettify/prettify.js"></script><script>$(function() {
  // make result of marked for pretty print
  $('pre code[class^="lang-"]').addClass('.prettyprint');
  window.prettyPrint && prettyPrint()
});
$('body').on('click', '.showcode', function () {
  $(this).parent().find('pre.sourcecode').toggle();
  $('body').scrollspy('refresh');
});
$('#options-private').on('click', function () {
  $('.private').toggle();
  $('body').scrollspy('refresh');
});</script><a href="https://github.com/croquiscom/crojsdoc"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" class="github-ribbon"></a></body></html>